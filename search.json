[{"title":"Forum(1)","url":"/2022/05/18/Forum/","content":"<h2 id=\"帖子\"><a href=\"#帖子\" class=\"headerlink\" title=\"帖子\"></a>帖子</h2><h3 id=\"发帖\"><a href=\"#发帖\" class=\"headerlink\" title=\"发帖\"></a>发帖</h3><blockquote>\n<p>PostController.java</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ApiOperation(value = &quot;新增&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@PreAuthorize(&quot;isAuthenticated()&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@PostMapping(&quot;/create&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> ApiResult&lt;Post&gt; <span class=\"title function_\">create</span><span class=\"params\">(<span class=\"meta\">@RequestBody</span> PostDTO dto, Principal principal)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> userService.getUserByUsername(principal.getName());</span><br><span class=\"line\">    <span class=\"type\">Post</span> <span class=\"variable\">post</span> <span class=\"operator\">=</span> postService.create(dto, user);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ApiResult.success(post);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p><code>@PreAuthorize(&quot;isAuthenticated()&quot;)</code>注解表示需要登录才能访问。</p>\n</blockquote>\n<blockquote>\n<p>此方法中两个参数表示，前端给后端发送数据的格式，以及当前登录用户的信息。<br>当调用此方法时会通过Spring的Principal对象获取当前登录用户的信息。再将用户信息和前端发送的数据进行处理。</p>\n</blockquote>\n<blockquote>\n<p>PostServiceImpl.java</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"meta\">@Transactional(rollbackFor = Exception.class)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Post <span class=\"title function_\">create</span><span class=\"params\">(PostDTO dto, User user)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Post</span> <span class=\"variable\">post1</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.baseMapper.selectOne(<span class=\"keyword\">new</span> <span class=\"title class_\">LambdaQueryWrapper</span>&lt;Post&gt;().eq(Post::getTitle, wordFilter.replaceWords(dto.getTitle())));</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!ObjectUtils.isEmpty(post1))&#123;</span><br><span class=\"line\">            ApiAsserts.fail(<span class=\"string\">&quot;标题重复，请重新编辑&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//封装</span></span><br><span class=\"line\">        <span class=\"type\">Post</span> <span class=\"variable\">post</span> <span class=\"operator\">=</span> Post.builder()</span><br><span class=\"line\">                .userId(user.getId())</span><br><span class=\"line\"><span class=\"comment\">//                .title(dto.getTitle()) 敏感词过滤</span></span><br><span class=\"line\">                .title(wordFilter.replaceWords(dto.getTitle()))</span><br><span class=\"line\"><span class=\"comment\">//                .content(EmojiParser.parseToAliases(dto.getContent()))</span></span><br><span class=\"line\">                .content(EmojiParser.parseToAliases(wordFilter.replaceWords(dto.getContent())))</span><br><span class=\"line\">                .createTime(<span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.baseMapper.insert(post);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//用户积分增加</span></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">newScore</span> <span class=\"operator\">=</span> user.getScore() + <span class=\"number\">1</span>;</span><br><span class=\"line\">        userMapper.updateById(user.setScore(newScore));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//标签</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!ObjectUtils.isEmpty(dto.getTags()))&#123;</span><br><span class=\"line\">            <span class=\"comment\">//保存标签</span></span><br><span class=\"line\">            List&lt;Tag&gt; tags = tagService.insertTags(dto.getTags());</span><br><span class=\"line\">            <span class=\"comment\">//处理标签与话题的关联</span></span><br><span class=\"line\">            postTagService.createPostTag(post.getId(),tags);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> post;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>在此方法中，我们首先通过标题进行查询，如果查询到了相同的标题，则抛出异常。检查通过会通过<code>lombok</code>的<code>@Builder</code>注解进行封装，并将修改好的数据插入数据库。随之进行用户积分的增加与标签的保存。（在封装数据的时候会对帖子的标题以及内容进行敏感词过滤替换）</p>\n</blockquote>\n<h3 id=\"帖子详情\"><a href=\"#帖子详情\" class=\"headerlink\" title=\"帖子详情\"></a>帖子详情</h3><blockquote>\n<p>PostController.java</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ApiOperation(value = &quot;详情&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@GetMapping()</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> ApiResult&lt;Map&lt;String, Object&gt;&gt; <span class=\"title function_\">view</span><span class=\"params\">(<span class=\"meta\">@RequestParam(&quot;id&quot;)</span> String id)</span> &#123;</span><br><span class=\"line\">        Map&lt;String, Object&gt; map = postService.viewPost(id);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ApiResult.success(map);</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>PostServiceImpl.java</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Map&lt;String, Object&gt; <span class=\"title function_\">viewPost</span><span class=\"params\">(String id)</span> &#123;</span><br><span class=\"line\">        Map&lt;String,Object&gt; map = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;(<span class=\"number\">16</span>);</span><br><span class=\"line\">        <span class=\"type\">Post</span> <span class=\"variable\">post</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.baseMapper.selectById(id);</span><br><span class=\"line\">        Assert.notNull(post,<span class=\"string\">&quot;当前话题不存在,或已被作者删除&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//查询话题详情</span></span><br><span class=\"line\">        post.setView(post.getView()+<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.baseMapper.updateById(post);</span><br><span class=\"line\">        <span class=\"comment\">//emoji转码</span></span><br><span class=\"line\">        post.setContent(EmojiParser.parseToUnicode(post.getContent()));</span><br><span class=\"line\">        map.put(<span class=\"string\">&quot;post&quot;</span>, post);</span><br><span class=\"line\">        <span class=\"comment\">//标签</span></span><br><span class=\"line\">        QueryWrapper&lt;PostTag&gt;wrapper = <span class=\"keyword\">new</span> <span class=\"title class_\">QueryWrapper</span>&lt;&gt;();</span><br><span class=\"line\">        wrapper.lambda().eq(PostTag::getTopicId, post.getId());</span><br><span class=\"line\">        Set&lt;String&gt; set = <span class=\"keyword\">new</span> <span class=\"title class_\">HashSet</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (PostTag articleTag : postTagService.list(wrapper))&#123;</span><br><span class=\"line\">            set.add(articleTag.getTagId());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        List&lt;Tag&gt; tags = tagService.listByIds(set);</span><br><span class=\"line\">        map.put(<span class=\"string\">&quot;tags&quot;</span>, tags);</span><br><span class=\"line\">        <span class=\"comment\">//作者</span></span><br><span class=\"line\">        <span class=\"type\">ProfileVO</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> userService.getUserProfile(post.getUserId());</span><br><span class=\"line\">        map.put(<span class=\"string\">&quot;user&quot;</span>, user);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> map;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>查看帖子详情时，会首先判断数据库中是否存在这条数据。判断通过之后会将帖子的浏览量增加，并将帖子的内容转码。将转码后的帖子内容存进创建的map中。<br>封装好帖子信息之后，我们需要通过帖子id来查询当前帖子所关联的标签id。再通过这些标签id获得标签信息，并将结果封装进map。<br>第三步，我们需要通过帖子的作者id来查询作者的信息，并将结果封装进map。再将map封装进ApiResult返回。</p>\n</blockquote>\n<hr>\n<h2 id=\"评论\"><a href=\"#评论\" class=\"headerlink\" title=\"评论\"></a>评论</h2><h3 id=\"一级评论\"><a href=\"#一级评论\" class=\"headerlink\" title=\"一级评论\"></a>一级评论</h3><blockquote>\n<p>CommentController.java</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ApiOperation(value = &quot;新增评论&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@PreAuthorize(&quot;isAuthenticated()&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@PostMapping(&quot;/add_comment&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> ApiResult&lt;Comment&gt; <span class=\"title function_\">add_comment</span><span class=\"params\">(<span class=\"meta\">@RequestBody</span> CommentDTO dto, Principal principal)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (dto.getContent() == <span class=\"literal\">null</span> || <span class=\"string\">&quot;&quot;</span>.equals(dto.getContent()) || <span class=\"string\">&quot;\\n&quot;</span>.equals(dto.getContent())) &#123;</span><br><span class=\"line\">        ApiAsserts.fail(<span class=\"string\">&quot;评论内容不能为空&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> userService.getUserByUsername(principal.getName());</span><br><span class=\"line\">    <span class=\"type\">Comment</span> <span class=\"variable\">comment</span> <span class=\"operator\">=</span> commentService.create(dto, user);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> ApiResult.success(comment);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>在此方法中参数与上节发帖方法中的参数相同，不作过多解释。<br>在进入此方法时，会先检查评论内容是否为空，如果为空则抛出异常。 验证通过之后会调用getUserByUsername方法获取当前登录用户的信息，并将用户信息和前端发送的数据进行处理。</p>\n</blockquote>\n<blockquote>\n<p>CommentServiceImpl.java</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Comment <span class=\"title function_\">create</span><span class=\"params\">(CommentDTO dto, User user)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Comment</span> <span class=\"variable\">comment</span> <span class=\"operator\">=</span> Comment.builder()</span><br><span class=\"line\">                .userId(user.getId())</span><br><span class=\"line\">                .content(wordFilter.replaceWords(dto.getContent()))</span><br><span class=\"line\">                .topicId(dto.getTopic_id())</span><br><span class=\"line\">                .createTime(<span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.baseMapper.insert(comment);</span><br><span class=\"line\">        messageService.createMessage(user.getId(),postService.getById(dto.getTopic_id()).getUserId() ,<span class=\"string\">&quot;评论了你的帖子:&quot;</span> + comment.getContent());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> comment;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>这里首先对数据进行封装处理，并将封装结果插入数据库。然后调用<code>messageService</code>的<code>createMessage</code>方法，将当前评论的用户<code>id</code>和帖子的用户id作为参数传入，并将评论内容作为消息内容。</p>\n</blockquote>\n<hr>\n<h3 id=\"二级评论\"><a href=\"#二级评论\" class=\"headerlink\" title=\"二级评论\"></a>二级评论</h3><blockquote>\n<p>CommentController.java</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ApiOperation(value = &quot;新增二级评论&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@PreAuthorize(&quot;isAuthenticated()&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@PostMapping(&quot;/add_child_comment&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> ApiResult&lt;Comment&gt; <span class=\"title function_\">add_child_comment</span><span class=\"params\">(<span class=\"meta\">@RequestBody</span> ChildCommentDTO dto,Principal principal)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (dto.getChild_comment_content() == <span class=\"literal\">null</span> || <span class=\"string\">&quot;&quot;</span>.equals(dto.getChild_comment_content()) || <span class=\"string\">&quot;\\n&quot;</span>.equals(dto.getChild_comment_content())) &#123;</span><br><span class=\"line\">        ApiAsserts.fail(<span class=\"string\">&quot;评论内容不能为空&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> userService.getUserByUsername(principal.getName());</span><br><span class=\"line\">        <span class=\"type\">Comment</span> <span class=\"variable\">comment</span> <span class=\"operator\">=</span> commentService.create(dto, user);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ApiResult.success(comment);</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>新增二级评论的方法逻辑其实是与上面的一级评论一样的，他们的不同只是二级评论在创建的时候会同时插入一级评论的id作为<code>roo_id</code>。 </p>\n</blockquote>\n<img src=\"/2022/05/18/Forum/img.png\" class=\"\" title=\"评论表\">\n\n<blockquote>\n<p>从这个表中其实可以看到，一级评论的<code>root_id</code>属性都是空的，而二级评论的<code>root_id</code>属性都是一级评论的id。下面来介绍一下二级评论的具体实现。</p>\n</blockquote>\n<blockquote>\n<p>CommentServiceImpl.java</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Comment <span class=\"title function_\">create</span><span class=\"params\">(ChildCommentDTO dto, User user)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">Comment</span> <span class=\"variable\">comment</span> <span class=\"operator\">=</span> Comment.builder()</span><br><span class=\"line\">            .userId(user.getId())</span><br><span class=\"line\">            .content(wordFilter.replaceWords(dto.getChild_comment_content()))</span><br><span class=\"line\">            .topicId(<span class=\"built_in\">this</span>.getById(dto.getContent_parent_id()).getTopicId())</span><br><span class=\"line\">            .rootId(dto.getContent_parent_id())</span><br><span class=\"line\">            .createTime(<span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>())</span><br><span class=\"line\">            .build();</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.baseMapper.insert(comment);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> comment;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>这里首先对数据进行封装处理，并将封装结果插入数据库。然后调用<code>getById</code>方法获取父评论的信息，并将父评论的<code>topicId</code>属性作为该二级评论的<code>root_Id</code>属性。</p>\n</blockquote>\n","categories":["JAVA"],"tags":["SpringBoot","Vue","教程"]},{"title":"SQL 优化","url":"/2022/09/11/SQL-%E4%BC%98%E5%8C%96/","content":"<h1 id=\"SQL-优化的几种方式\"><a href=\"#SQL-优化的几种方式\" class=\"headerlink\" title=\"SQL 优化的几种方式\"></a>SQL 优化的几种方式</h1><hr>\n<h2 id=\"1-SQL语句的优化\"><a href=\"#1-SQL语句的优化\" class=\"headerlink\" title=\"1.SQL语句的优化\"></a>1.SQL语句的优化</h2><blockquote>\n<h3 id=\"1-1-SQL语句中In包含的值不应过多。\"><a href=\"#1-1-SQL语句中In包含的值不应过多。\" class=\"headerlink\" title=\"1.1 SQL语句中In包含的值不应过多。\"></a>1.1 SQL语句中<code>In</code>包含的值不应过多。</h3><p>如 <code>select id from t where num in (1,2,3)</code>对于连续的值，应尽量使用<code>Between</code>，避免使用<code>In</code>。如<code>select id from t where num between 1 and 3</code>。</p>\n</blockquote>\n<hr>\n<blockquote>\n<h3 id=\"1-2-SELECT语句必须指明字段名称。\"><a href=\"#1-2-SELECT语句必须指明字段名称。\" class=\"headerlink\" title=\"1.2 SELECT语句必须指明字段名称。\"></a>1.2 SELECT语句必须指明字段名称。</h3><p>禁止使用<code>*</code>进行查询。<br>如<code>select * from t</code>需要修改为指明字段的查询<code>select id, name from t</code>。</p>\n</blockquote>\n<hr>\n<blockquote>\n<h3 id=\"1-3-在只查询一条数据的时候，使用Limit-1。\"><a href=\"#1-3-在只查询一条数据的时候，使用Limit-1。\" class=\"headerlink\" title=\"1.3 在只查询一条数据的时候，使用Limit 1。\"></a>1.3 在只查询一条数据的时候，使用<code>Limit 1</code>。</h3></blockquote>\n<hr>\n<blockquote>\n<h3 id=\"1-4-Where子句编写不当，会造成索引失效。\"><a href=\"#1-4-Where子句编写不当，会造成索引失效。\" class=\"headerlink\" title=\"1.4 Where子句编写不当，会造成索引失效。\"></a>1.4 Where子句编写不当，会造成索引失效。</h3><p><strong>以下行为都会造成引擎放弃使用索引而进行全表扫描</strong>。</p>\n<ol>\n<li>在Where子句中使用<code>!=</code>或<code>&lt;&gt;</code>操作符。建议使用<code>&gt;=</code>或<code>&lt;=</code></li>\n<li>在where子句中对字段进行<code>null</code>值判断。如<code>select id from user where name = null</code>（<code>null</code>判断中会根据<code>null</code>和非<code>null</code>的数量来进行判断是否走索引）</li>\n<li>在where子句中使用<code>or</code>来连接条件。如<code>select id from user  where num = 10 or num =20</code>，应修改为<code> select id from user where num = 10 union all select id from user where num = 20</code></li>\n<li>在where子句中对字段进行表达式判断。如<code>select id from user where num/2 = 100 </code>，应修改为<code>select id from user where num = 100*2</code>。</li>\n<li>在where子句中对字段进行函数操作，如<code>select id from user where substring(name,1,3) = &#39;abc&#39;</code>。</li>\n<li>在where子句中的<code>=</code>的左边进行函数、算数运行或其它表达式运算。</li>\n</ol>\n</blockquote>\n<hr>\n<blockquote>\n<h3 id=\"1-5-对于联合索引来说，要遵守最左前缀法则。\"><a href=\"#1-5-对于联合索引来说，要遵守最左前缀法则。\" class=\"headerlink\" title=\"1.5 对于联合索引来说，要遵守最左前缀法则。\"></a>1.5 对于联合索引来说，要遵守最左前缀法则。</h3><p>例如组合索引(id,name,sex)  使用的时候,可以id 或者id,name .  禁止直接name,或者sex.会导致联合索引失败<br>注意: id, name,sex 这三个字段填写顺序不会有影响,  mysql会自动优化成最左匹配的顺序.<br>前三条sql都能命中索引,中间两条由于不符合最左匹配原则,索引失效.<br>最后一条sql 由于有最左索引id 所以索引部分成功,部分失效.  id字段索引使用成功.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">explain select * from  `user_test` where uid=10  ; </span><br><span class=\"line\">explain select * from  `user_test` where uid=10 and name=&#x27;张三&#x27;;</span><br><span class=\"line\">explain select * from  `user_test` where uid=10 and name=&#x27;张三&#x27; and phone=&#x27;13527748096&#x27;;</span><br><span class=\"line\">explain select * from  `user_test` where name=&#x27;张三&#x27; and phone=&#x27;13527748096&#x27;;</span><br><span class=\"line\">explain select * from  `user_test` where name=&#x27;张三&#x27;;</span><br><span class=\"line\">explain select * from  `user_test` where uid=10 and phone=&#x27;13527748096&#x27;;</span><br></pre></td></tr></table></figure>\n</blockquote>\n<hr>\n<blockquote>\n<h3 id=\"1-6-尽量使用inner-join，避免left-join。\"><a href=\"#1-6-尽量使用inner-join，避免left-join。\" class=\"headerlink\" title=\"1.6 尽量使用inner join，避免left join。\"></a>1.6 尽量使用inner join，避免left join。</h3><p>如果连接方式是inner join，在没有其他过滤条件的情况下MySQL会自动选择小表作为驱动表，但是left join在驱动表的选择上遵循的是左边驱动右边的原则，即left join左边的表名为驱动表。</p>\n</blockquote>\n<hr>\n<blockquote>\n<h3 id=\"1-7-不建议使用-前缀模糊查询。\"><a href=\"#1-7-不建议使用-前缀模糊查询。\" class=\"headerlink\" title=\"1.7 不建议使用%前缀模糊查询。\"></a>1.7 不建议使用%前缀模糊查询。</h3><p>如<code>like &quot;%name&quot;</code>或者<code>like &quot;%name%&quot;</code>，会造成索引失效，应修改为<code>like &quot;name%&quot;</code>。</p>\n</blockquote>\n<hr>\n<blockquote>\n<h3 id=\"1-8-字符串类型的字段-查询的时候如果不加引号’’-会导致自动进行隐式转换-然后索引失效\"><a href=\"#1-8-字符串类型的字段-查询的时候如果不加引号’’-会导致自动进行隐式转换-然后索引失效\" class=\"headerlink\" title=\"1.8 字符串类型的字段 查询的时候如果不加引号’’  ,会导致自动进行隐式转换,然后索引失效\"></a>1.8 字符串类型的字段 查询的时候如果不加引号’’  ,会导致自动进行隐式转换,然后索引失效</h3></blockquote>\n<hr>\n<blockquote>\n<h3 id=\"1-9-order-by-排序优化-排序时-使用有索引的字段进行排序\"><a href=\"#1-9-order-by-排序优化-排序时-使用有索引的字段进行排序\" class=\"headerlink\" title=\"1.9 order by 排序优化 (排序时,使用有索引的字段进行排序)\"></a>1.9 order by 排序优化 (排序时,使用有索引的字段进行排序)</h3></blockquote>\n<hr>\n<blockquote>\n<h3 id=\"1-10-count-优化-速度-count-gt-count-1-gt-count-字段\"><a href=\"#1-10-count-优化-速度-count-gt-count-1-gt-count-字段\" class=\"headerlink\" title=\"1.10 count 优化     速度:count(*)&gt;count(1)&gt;count(字段)\"></a>1.10 count 优化     速度:count(*)&gt;count(1)&gt;count(字段)</h3><p> inndb引擎的使用如下  (MyIASM默认存了数据总数,所以效率最高)<br>1:count(字段):遍历整张表 会把每一行的字段值取出来,然后返回<br>2:count(1): 便利整张表,但不取值,对于返回的数据,放入1进去.然后累加<br>3:count(*):inndb引擎,特意做了优化,不会取出值,直接服务层进行累加  </p>\n</blockquote>\n","categories":["Mysql"],"tags":["Mysql","数据库"]},{"title":"Hexo 博客常用命令","url":"/2022/09/11/Hexo-%E5%8D%9A%E5%AE%A2%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/","content":"<h1 id=\"新建文章\"><a href=\"#新建文章\" class=\"headerlink\" title=\"新建文章\"></a>新建文章</h1><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo <span class=\"keyword\">new</span> <span class=\"string\">&quot;文章标题&quot;</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>缩写</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo n <span class=\"string\">&quot;文章标题&quot;</span></span><br></pre></td></tr></table></figure>\n</blockquote>\n<hr>\n<h1 id=\"新建页面\"><a href=\"#新建页面\" class=\"headerlink\" title=\"新建页面\"></a>新建页面</h1><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo <span class=\"keyword\">new</span> page <span class=\"string\">&quot;页面名&quot;</span></span><br></pre></td></tr></table></figure>\n<hr>\n<h1 id=\"生成静态页面至public目录\"><a href=\"#生成静态页面至public目录\" class=\"headerlink\" title=\"生成静态页面至public目录\"></a>生成静态页面至public目录</h1><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo generate</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>缩写</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo g</span><br></pre></td></tr></table></figure>\n</blockquote>\n<hr>\n<h1 id=\"开启预览访问端口（端口地址默认4000）\"><a href=\"#开启预览访问端口（端口地址默认4000）\" class=\"headerlink\" title=\"开启预览访问端口（端口地址默认4000）\"></a>开启预览访问端口（端口地址默认4000）</h1><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo server</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>缩写</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo s</span><br></pre></td></tr></table></figure>\n</blockquote>\n<hr>\n<h1 id=\"部署到github\"><a href=\"#部署到github\" class=\"headerlink\" title=\"部署到github\"></a>部署到github</h1><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo deploy</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>缩写</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo d</span><br></pre></td></tr></table></figure>\n</blockquote>\n<hr>\n<h1 id=\"清除缓存\"><a href=\"#清除缓存\" class=\"headerlink\" title=\"清除缓存\"></a>清除缓存</h1><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo clean</span><br></pre></td></tr></table></figure>\n<hr>\n<h1 id=\"组合命令\"><a href=\"#组合命令\" class=\"headerlink\" title=\"组合命令\"></a>组合命令</h1><blockquote>\n<h2 id=\"生成并本地预览\"><a href=\"#生成并本地预览\" class=\"headerlink\" title=\"生成并本地预览\"></a>生成并本地预览</h2><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo s -g</span><br></pre></td></tr></table></figure>\n<hr>\n<h2 id=\"生成并上传\"><a href=\"#生成并上传\" class=\"headerlink\" title=\"生成并上传\"></a>生成并上传</h2><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo d -g</span><br></pre></td></tr></table></figure>\n</blockquote>\n"},{"title":"七牛云使用笔记","url":"/2022/05/11/oss/","content":"<h2 id=\"七牛云配置\"><a href=\"#七牛云配置\" class=\"headerlink\" title=\"七牛云配置\"></a>七牛云配置</h2><ul>\n<li><p>进入七牛云官网<a href=\"https://www.qiniu.com/\">七牛云 - 国内领先的企业级云服务商 (qiniu.com)</a></p>\n</li>\n<li><p>注册七牛云账号并登录,创建存储</p>\n</li>\n</ul>\n<img src=\"/2022/05/11/oss/image-20220429154222835.png\" class=\"\" title=\"This is an test img\">\n\n<img src=\"/2022/05/11/oss/image-20220429154426967.png\" class=\"\" title=\"This is an test img\">\n\n<img src=\"/2022/05/11/oss/image-20220429155608766.png\" class=\"\" title=\"This is an test img\">\n\n\n\n\n<h3 id=\"创建SpringBoot项目\"><a href=\"#创建SpringBoot项目\" class=\"headerlink\" title=\"创建SpringBoot项目\"></a>创建SpringBoot项目</h3><blockquote>\n<p> application.yml</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#七牛云配置</span></span><br><span class=\"line\"><span class=\"attr\">oss:</span></span><br><span class=\"line\">  <span class=\"attr\">domain:</span> <span class=\"string\">http://******.hd-bkt.clouddn.com/</span>  <span class=\"comment\"># 访问域名(默认使用七牛云测试域名) 测试域名有效期仅为30天，建议更换为自有域名</span></span><br><span class=\"line\">  <span class=\"attr\">accessKey:</span> <span class=\"string\">*****</span> <span class=\"comment\"># 公钥 AK</span></span><br><span class=\"line\">  <span class=\"attr\">secretKey:</span> <span class=\"string\">*****</span> <span class=\"comment\"># 私钥 SK</span></span><br><span class=\"line\">  <span class=\"attr\">bucket:</span> <span class=\"string\">****</span>  <span class=\"comment\">#存储空间名称 创建的存储空间名称</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>pom.xml</p>\n</blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.google.code.gson<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>gson<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.8.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.qiniu<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>qiniu-java-sdk<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>[7.7.0, 7.7.99]<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>UploadController.java</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Api(tags = &quot;上传&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UploadController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UploadService uploadService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@ApiOperation(value = &quot;文件上传&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping(&quot;/upload&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ApiResult <span class=\"title function_\">upload</span><span class=\"params\">(<span class=\"meta\">@RequestPart</span> MultipartFile file)</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">url</span> <span class=\"operator\">=</span> uploadService.upload(file);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ApiResult.success(url);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>UploadServiceImpl.java</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties(prefix = &quot;oss&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UploadServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">UploadService</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String accessKey;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String secretKey;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String bucket;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String domain;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">upload</span><span class=\"params\">(MultipartFile file)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//判断文件类型</span></span><br><span class=\"line\">        <span class=\"comment\">//获取原始文件名</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (file == <span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">            ApiAsserts.fail(<span class=\"string\">&quot;文件上传失败！&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">originalFileName</span> <span class=\"operator\">=</span> file.getOriginalFilename();</span><br><span class=\"line\">        <span class=\"comment\">//对原始文件名进行判断</span></span><br><span class=\"line\">        <span class=\"keyword\">assert</span> originalFileName != <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!originalFileName.endsWith(<span class=\"string\">&quot;.png&quot;</span>) &amp;&amp; !originalFileName.endsWith(<span class=\"string\">&quot;.jpg&quot;</span>) &amp;&amp; !originalFileName.endsWith(<span class=\"string\">&quot;.txt&quot;</span>))&#123;</span><br><span class=\"line\">            <span class=\"comment\">//TODO 抛出错误，此处只允许.png</span></span><br><span class=\"line\">            ApiAsserts.fail(<span class=\"string\">&quot;只可以上传png格式的图片哦！&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">path</span> <span class=\"operator\">=</span> PathUtils.generateFilePath(originalFileName);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> uploadOss(file,path);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String <span class=\"title function_\">uploadOss</span><span class=\"params\">(MultipartFile file , String path)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Configuration</span> <span class=\"variable\">cfg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Configuration</span>(Region.autoRegion());</span><br><span class=\"line\">        <span class=\"type\">UploadManager</span> <span class=\"variable\">uploadManager</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">UploadManager</span>(cfg);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> path;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">InputStream</span> <span class=\"variable\">inputStream</span> <span class=\"operator\">=</span> file.getInputStream();</span><br><span class=\"line\">            <span class=\"type\">Auth</span> <span class=\"variable\">auth</span> <span class=\"operator\">=</span> Auth.create(accessKey, secretKey);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">upToken</span> <span class=\"operator\">=</span> auth.uploadToken(bucket);</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">Response</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> uploadManager.put(inputStream, key, upToken, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">                <span class=\"type\">DefaultPutRet</span> <span class=\"variable\">putRet</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Gson</span>().fromJson(response.bodyString(), DefaultPutRet.class);</span><br><span class=\"line\">                System.out.println(putRet.key);</span><br><span class=\"line\">                System.out.println(putRet.hash);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> domain+key;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (QiniuException e) &#123;</span><br><span class=\"line\">                <span class=\"type\">Response</span> <span class=\"variable\">r</span> <span class=\"operator\">=</span> e.response;</span><br><span class=\"line\">                System.err.println(r.toString());</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    System.err.println(r.bodyString());</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (QiniuException e2) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;www&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>PathUtils.java</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">PathUtils</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">generateFilePath</span><span class=\"params\">(String fileName)</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//根据日期生成路径 2022/1/15/</span></span><br><span class=\"line\">        <span class=\"type\">SimpleDateFormat</span> <span class=\"variable\">sdf</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleDateFormat</span>(<span class=\"string\">&quot;yyyy/MM/dd/&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">datePath</span> <span class=\"operator\">=</span> sdf.format(<span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>());</span><br><span class=\"line\">        <span class=\"comment\">//uuid作为文件名</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">uuid</span> <span class=\"operator\">=</span> UUID.randomUUID().toString().replaceAll(<span class=\"string\">&quot;-&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//后缀和文件后缀一致</span></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">index</span> <span class=\"operator\">=</span> fileName.lastIndexOf(<span class=\"string\">&quot;.&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//test.jpg -&gt; .jpg</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">fileType</span> <span class=\"operator\">=</span> fileName.substring(index);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StringBuilder</span>().append(datePath).append(uuid).append(fileType).toString();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h2><p>使用ApiPost进行测试</p>\n<img src=\"/2022/05/11/oss/image-20220429162138190.png\" class=\"\" title=\"测试\">\n\n\n<img src=\"/2022/05/11/oss/image-20220429164117255.png\" class=\"\" title=\"测试\">\n\n\n<p>即可在浏览器中访问到此资源。</p>\n"},{"title":"Mysql 索引","url":"/2022/09/11/Mysql-%E7%B4%A2%E5%BC%95%E5%AD%A6%E4%B9%A0/","content":"<h1 id=\"什么是索引？\"><a href=\"#什么是索引？\" class=\"headerlink\" title=\"什么是索引？\"></a>什么是索引？</h1><blockquote>\n<p>MySql官方对此的解释为：索引是帮助MySql高效获取数据的数据结构。索引是一种用于快速查询和检索数据的数据结构。<br>MySql中的索引结构有:  B+树和Hash。</p>\n</blockquote>\n<hr>\n<h1 id=\"MySql中有哪些索引？\"><a href=\"#MySql中有哪些索引？\" class=\"headerlink\" title=\"MySql中有哪些索引？\"></a>MySql中有哪些索引？</h1><blockquote>\n<h2 id=\"单列索引\"><a href=\"#单列索引\" class=\"headerlink\" title=\"单列索引\"></a>单列索引</h2><p>单列索引：单列索引中包含(普通,唯一,主键,前缀)这四个索引.  一个索引只包含单个列，但一个表中可以有多个单列索引。<br> 普通索引：普通索引的唯一作用就是为了快速查询数据，一张表允许创建多个普通索引，并允许数据重复和NULL。<br> 唯一索引：索引列中的值必须是唯一的，但是允许为空值，<br> 主键索引：是一种特殊的唯一索引，不允许有空值。<br> 前缀索引 ：前缀索引只适用于字符串类型的数据。前缀索引是对文本的前几个字符创建索引，相比普通索引建立的数据更小， 因为只取前几个字符。</p>\n</blockquote>\n<hr>\n<blockquote>\n<h2 id=\"组合索引\"><a href=\"#组合索引\" class=\"headerlink\" title=\"组合索引\"></a>组合索引</h2><p>组合索引: 在表中的多个字段组合上创建的索引，只有在查询条件中使用了这些字段的左边字段时，索引才会被使用，使用组合索引时遵循最左前缀集合。这个如果还不明白，等后面举例讲解时在细说　</p>\n</blockquote>\n<hr>\n<blockquote>\n<h2 id=\"全文索引\"><a href=\"#全文索引\" class=\"headerlink\" title=\"全文索引\"></a>全文索引</h2><p>全文索引: 全文索引主要是为了检索大文本数据中的关键字的信息，是目前搜索引擎数据库使用的一种技术。Mysql5.6之前只有MYISAM引擎支持全文索引，5.6之后InnoDB也支持了全文索引。</p>\n</blockquote>\n<hr>\n<blockquote>\n<h2 id=\"空间索引\"><a href=\"#空间索引\" class=\"headerlink\" title=\"空间索引\"></a>空间索引</h2><p>空间索引　: 是对空间数据类型的字段建立的索引，MySQL中的空间数据类型有四种，GEOMETRY、POINT、LINESTRING、POLYGON。　在创建空间索引时，使用SPATIAL关键字。</p>\n</blockquote>\n<hr>\n<blockquote>\n<h2 id=\"InnoDB存储引擎下的索引分类\"><a href=\"#InnoDB存储引擎下的索引分类\" class=\"headerlink\" title=\"InnoDB存储引擎下的索引分类\"></a>InnoDB存储引擎下的索引分类</h2><p>根据索引的存储形式分为聚集索引和二级索引。</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>分类</th>\n<th>含义</th>\n<th>特点</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>聚集索引(Clustered Index)</td>\n<td>将数据存储与索引放到一起，索引结构的叶子结点保存了行数据</td>\n<td>必须有，且只有一个</td>\n</tr>\n<tr>\n<td>二级索引(Secondary Index)</td>\n<td>将数据和索引分开存储，索引结构的叶子结点关联的事对应的主键</td>\n<td>可以存在多个</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p>聚集索引选取规则：</p>\n<blockquote>\n<p>如果存在主键，主键索引就是聚集索引<br>如果不存在主键，将使用第一个唯一（UNIQUE）索引作为聚集索引。<br>如果表没有主键，或没有合适的唯一索引，则InnoDB会自动生成一个rowid作为隐藏的聚集索引。</p>\n</blockquote>\n</blockquote>\n<hr>\n<h1 id=\"添加索引的sql语句\"><a href=\"#添加索引的sql语句\" class=\"headerlink\" title=\"添加索引的sql语句\"></a>添加索引的sql语句</h1><h2 id=\"添加PRIMARY-KEY（主键索引）\"><a href=\"#添加PRIMARY-KEY（主键索引）\" class=\"headerlink\" title=\"添加PRIMARY KEY（主键索引）\"></a>添加PRIMARY KEY（主键索引）</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">ALTER TABLE `table_name` ADD PRIMARY KEY ( `column` ) </span><br></pre></td></tr></table></figure>\n<h2 id=\"添加UNIQUE-唯一索引\"><a href=\"#添加UNIQUE-唯一索引\" class=\"headerlink\" title=\"添加UNIQUE(唯一索引)\"></a>添加UNIQUE(唯一索引)</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">ALTER TABLE `table_name` ADD UNIQUE ( `column` ) </span><br></pre></td></tr></table></figure>\n<h2 id=\"添加INDEX-普通索引\"><a href=\"#添加INDEX-普通索引\" class=\"headerlink\" title=\"添加INDEX(普通索引)\"></a>添加INDEX(普通索引)</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">ALTER TABLE `table_name` ADD INDEX index_name ( `column` )</span><br></pre></td></tr></table></figure>\n<h2 id=\"添加FULLTEXT-全文索引\"><a href=\"#添加FULLTEXT-全文索引\" class=\"headerlink\" title=\"添加FULLTEXT(全文索引)\"></a>添加FULLTEXT(全文索引)</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">ALTER TABLE `table_name` ADD FULLTEXT ( `column`) </span><br></pre></td></tr></table></figure>\n<h2 id=\"添加多列索引\"><a href=\"#添加多列索引\" class=\"headerlink\" title=\"添加多列索引\"></a>添加多列索引</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">ALTER TABLE `table_name` ADD INDEX index_name ( `column1`, `column2`, `column3` )</span><br></pre></td></tr></table></figure>\n<hr>\n<h1 id=\"索引的底层数据结构\"><a href=\"#索引的底层数据结构\" class=\"headerlink\" title=\"索引的底层数据结构\"></a>索引的底层数据结构</h1><blockquote>\n<h2 id=\"哈希索引\"><a href=\"#哈希索引\" class=\"headerlink\" title=\"哈希索引\"></a>哈希索引</h2><blockquote>\n<p>对于哈希索引来说，底层的数据结构就是哈希表，因此在绝大多数需求为单条记录查询的时候，可以选择哈希索引，查询性能最快；其余大部分场景，建议选择BTree索引。</p>\n</blockquote>\n<h2 id=\"BTree树索引\"><a href=\"#BTree树索引\" class=\"headerlink\" title=\"BTree树索引\"></a>BTree树索引</h2><blockquote>\n<p>是一种很普遍的数据库索引结构。其特点是定位高效、利用率高、自我平衡，理论上，使用Btree在亿条数据与100条数据中定位记录的花销相同。</p>\n</blockquote>\n</blockquote>\n<hr>\n<h1 id=\"为什么索引会提高查找速度\"><a href=\"#为什么索引会提高查找速度\" class=\"headerlink\" title=\"为什么索引会提高查找速度?\"></a>为什么索引会提高查找速度?</h1><blockquote>\n<p>这首先要从mysql的存储说起:  mysql的存储形式是页, 在没有使用索引时,</p>\n<blockquote>\n<p>定位到记录所在的页：需要遍历双向链表，找到所在的页<br>从所在的页内中查找相应的记录：由于不是根据主键查询，只能遍历所在页的单链表了,这种查找时间复杂度为O(n)<br>当添加索引后: 就是将无序的数据变成有序(相对),通过 “目录” 就可以很快地定位到对应的页上了！（二分查找，时间复杂度近似为O(logn)）</p>\n</blockquote>\n</blockquote>\n<hr>\n<h1 id=\"使用索引的注意事项\"><a href=\"#使用索引的注意事项\" class=\"headerlink\" title=\"使用索引的注意事项\"></a>使用索引的注意事项</h1><blockquote>\n<p> 经常需要搜索的列上，可以加快搜索的速度；<br> 在经常使用在WHERE子句中的列上面创建索引，加快条件的判断速度。<br> 在经常需要排序的列上创 建索引，因为索引已经排序，这样查询可以利用索引的排序，加快排序查询时间；<br> 对于中到大型表索引都是非常有效的，但是特大型表的话维护开销会很大，不适合建索引<br> 在经常用在连接的列上，这 些列主要是一些外键，可以加快连接的速度；<br> 避免 where 子句中对宇段施加函数，这会造成无法命中索引。<br> 在使用InnoDB时使用与业务无关的自增主键作为主键，即使用逻辑主键，而不要使用业务主键。<br>删除长期未使用的索引。</p>\n</blockquote>\n<blockquote>\n<p>引用地址 <a href=\"https://javaguide.cn/\">JavaGuide</a></p>\n</blockquote>\n","categories":["Mysql"],"tags":["Mysql","数据库"]},{"title":"RocketMQ","url":"/2022/09/12/RocketMQ/","content":"<h2 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h2><blockquote>\n<h3 id=\"Producer（生产者）\"><a href=\"#Producer（生产者）\" class=\"headerlink\" title=\"Producer（生产者）\"></a>Producer（生产者）</h3><p>即消息生产者，负责生产消息。</p>\n<blockquote>\n<p>RocketMQ中的生产者都是以生产者组的形式出现的。生产者组是统一类生产者的集合，这类生产者发送相同Topic（主题）的消息。一个生产者组可以同时发送多个主题的消息。</p>\n</blockquote>\n</blockquote>\n<hr>\n<blockquote>\n<h3 id=\"Consumer（消费者）\"><a href=\"#Consumer（消费者）\" class=\"headerlink\" title=\"Consumer（消费者）\"></a>Consumer（消费者）</h3><p>即消息消费者，负责消费消息。消费者会从Broker服务器中获取到消息，并对消息进行业务处理。</p>\n<blockquote>\n<p>RocketMQ中的消息消费者都是以消费者组（Consumer Group）的形式出现的。消费者组是同一类消费者的集合，这类Consumer消费的是同一个Topic类型的消息。</p>\n</blockquote>\n<hr>\n<blockquote>\n<p><strong>消费者组中Consumer的数量应该小于等于订阅Topic的Queue数量。如果超出Queue数量，则多出的Consumer将不能消费消息。</strong></p>\n</blockquote>\n<hr>\n<blockquote>\n<p>一个Topic类型的消息可以被多个消费者组同时消费。</p>\n</blockquote>\n<hr>\n<blockquote>\n<p><strong>消费者组只能消费一个Topic的消息，不能同时消费多个Topic消息</strong></p>\n<p><strong>一个消费者组中的消费者必须订阅完全相同的Topic</strong></p>\n</blockquote>\n</blockquote>\n<hr>\n<blockquote>\n<h3 id=\"Broker\"><a href=\"#Broker\" class=\"headerlink\" title=\"Broker\"></a>Broker</h3><p><strong>Broker是 RocketMQ 的核心，大部分‘重量级”工作都是由 Broker完成的。<br>包括接收 Producer 发过来的消息、处理 Consumer 的消费消息请求、消息的持 久化存储、消息的 HA 机制以及服务端过滤功能等 。</strong></p>\n</blockquote>\n<hr>\n<blockquote>\n<h3 id=\"Topic（主题）\"><a href=\"#Topic（主题）\" class=\"headerlink\" title=\"Topic（主题）\"></a>Topic（主题）</h3><p>消息类别。生产者可以给不同主题发送消息。消费者也可以订阅多个主题。</p>\n<blockquote>\n<p>一个主题可以包含多条消息，一条消息只能有一个主题。</p>\n</blockquote>\n</blockquote>\n<hr>\n<blockquote>\n<h3 id=\"Tag（子主题）\"><a href=\"#Tag（子主题）\" class=\"headerlink\" title=\"Tag（子主题）\"></a>Tag（子主题）</h3><p>消息的子主题。是主题下面的更细分，方便同一主题下消息的区分与查询。</p>\n<blockquote>\n<p>Topic是消息的一级分类，Tag是消息的二级分类。</p>\n</blockquote>\n</blockquote>\n<hr>\n<blockquote>\n<h3 id=\"GroupName（组）\"><a href=\"#GroupName（组）\" class=\"headerlink\" title=\"GroupName（组）\"></a>GroupName（组）</h3><p>代表具有相同角色的生产者组合或者消费者组合。称为生产者组或消费者组。</p>\n<blockquote>\n<p>在HA下多个生产者的情况下，一个生产者下线，可以联系该组中另外一个生产者实例继续完成任务，不至于影响整个业务。在消费者组中可以实现消息消费的负载均衡和消息容错目标。</p>\n</blockquote>\n</blockquote>\n<hr>\n<blockquote>\n<h3 id=\"Queue-（队列）\"><a href=\"#Queue-（队列）\" class=\"headerlink\" title=\"Queue （队列）\"></a>Queue （队列）</h3><p>存储消息的物理实体。一个Topic（主题）中可以包含多个Queue（队列），每个Queue中存放的就是该Topic的消息。一个Topic的Queue也被称为一个Topic中消息的分区（Partition）。</p>\n<blockquote>\n<p>一个Topic的Queue中的消息只能被一个__消费者组__中的一个消费者消费。或者一个Queue中的消息__不允许同一个消费者组__中的多个消费者同时消费。</p>\n</blockquote>\n</blockquote>\n<hr>\n<blockquote>\n<h3 id=\"MessageId-x2F-Key-（消息标识）\"><a href=\"#MessageId-x2F-Key-（消息标识）\" class=\"headerlink\" title=\"MessageId&#x2F;Key （消息标识）\"></a>MessageId&#x2F;Key （消息标识）</h3><p>RocketMQ中的每个消息都有唯一的MessageId，且可以携带具有业务标识的key，以方便对消息的查询。</p>\n<blockquote>\n<p>在生产者发送消息的时候会生成一个MessageId(msgId)，当消息到达Broker时，Broker也会自动生成一个MessageId(offsetMsgId），两者与key都被称为消息标识。</p>\n</blockquote>\n</blockquote>\n"},{"title":"JUC 笔记","url":"/2022/09/13/JUC-%E7%AC%94%E8%AE%B0/","content":""}]